<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cronômetro de Atividades</title>
</head>
<body>
  <h2>Registro de Atividades</h2>

  <label for="selectPredio">Prédio:</label>
  <select id="selectPredio" onchange="selecionarPredio()">
    <option value="">Selecione o prédio</option>
  </select>

  <label for="selectLinha">Linha:</label>
  <select id="selectLinha" onchange="selecionarLinha()">
    <option value="">Selecione a linha</option>
  </select>

  <label for="selectPosto">Posto:</label>
  <select id="selectPosto" onchange="selecionarPosto()">
    <option value="">Selecione o posto</option>
  </select>

  <label for="selectAtividade">Atividade:</label>
  <select id="selectAtividade">
    <option value="">Selecione a atividade</option>
  </select>

  <script>
    let dadosJson = [];

    async function carregarDadosJSON() {
      try {
        const response = await fetch("estrutura.json", { cache: "no-store" });
        if (!response.ok) throw new Error("Erro ao carregar estrutura.json");
        dadosJson = await response.json();
        preencherPredios();
      } catch (error) {
        console.error("Erro ao carregar estrutura.json:", error);
        alert("Falha ao carregar os dados de estrutura.json");
      }
    }

    function preencherPredios() {
      const select = document.getElementById("selectPredio");
      const predios = [...new Set(dadosJson.map(item => item.Predio))];
      select.innerHTML = '<option value="">Selecione o prédio</option>';
      predios.forEach(predio => {
        const option = document.createElement("option");
        option.value = predio;
        option.text = predio;
        select.appendChild(option);
      });
    }

    function selecionarPredio() {
      const predio = document.getElementById("selectPredio").value;
      const linhas = [...new Set(dadosJson.filter(item => item.Predio === predio).map(item => item.Linha))];
      const selectLinha = document.getElementById("selectLinha");
      selectLinha.innerHTML = '<option value="">Selecione a linha</option>';
      linhas.forEach(linha => {
        const option = document.createElement("option");
        option.value = linha;
        option.text = linha;
        selectLinha.appendChild(option);
      });

      document.getElementById("selectPosto").innerHTML = '<option value="">Selecione o posto</option>';
      document.getElementById("selectAtividade").innerHTML = '<option value="">Selecione a atividade</option>';
    }

    function selecionarLinha() {
      const predio = document.getElementById("selectPredio").value;
      const linha = document.getElementById("selectLinha").value;
      const postos = [...new Set(dadosJson.filter(item => item.Predio === predio && item.Linha === linha).map(item => item.Posto))];
      const selectPosto = document.getElementById("selectPosto");
      selectPosto.innerHTML = '<option value="">Selecione o posto</option>';
      postos.forEach(posto => {
        const option = document.createElement("option");
        option.value = posto;
        option.text = posto;
        selectPosto.appendChild(option);
      });

      document.getElementById("selectAtividade").innerHTML = '<option value="">Selecione a atividade</option>';
    }

    function selecionarPosto() {
      const predio = document.getElementById("selectPredio").value;
      const linha = document.getElementById("selectLinha").value;
      const posto = document.getElementById("selectPosto").value;
      const atividades = [...new Set(dadosJson.filter(item =>
        item.Predio === predio &&
        item.Linha === linha &&
        item.Posto === posto
      ).map(item => item.Atividade))];
      const selectAtividade = document.getElementById("selectAtividade");
      selectAtividade.innerHTML = '<option value="">Selecione a atividade</option>';
      atividades.forEach(atividade => {
        const option = document.createElement("option");
        option.value = atividade;
        option.text = atividade;
        selectAtividade.appendChild(option);
      });
    }

    window.addEventListener("load", carregarDadosJSON);
  </script>
</body>
</html>

